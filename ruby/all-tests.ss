#lang scheme


(require (only-in "peg.ss" dump-statistics))
(require "ruby.ss")
(require srfi/13)

(define failed-dirs '("tests/failing/mine"
		      "tests/failing/jruby"
		      "tests/failing/ruby"
		      "tests/failing/ruby/heredoc"
		      "tests/failing/rubyspec/core/array"
		      "tests/failing/rubyspec/fixtures"
		      "tests/failing/rubyspec/fixtures/require"
		      "tests/failing/rubyspec/fixtures/load"
		      "tests/failing/rubyspec/language"
		      "tests/failing/rubyspec/language/fixtures"
		      "tests/failing/rubyspec/library"
		      "tests/failing/rubyspec/library/mathn"
		      "tests/failing/rubyspec/library/mathn/math"
		      "tests/failing/rubyspec/library/mathn/math/fixtures"
		      "tests/failing/rubyspec/library/mathn/math/shared"
		      "tests/failing/rubyspec/library/mathn/rational"
		      "tests/failing/rubyspec/library/mathn/integer"
		      "tests/failing/rubyspec/library/mathn/prime"
		      "tests/failing/rubyspec/library/socket"
		      "tests/failing/rubyspec/library/socket/socket"
		      "tests/failing/rubyspec/library/socket/unixsocket"
		      "tests/failing/rubyspec/library/socket/unixsocket/shared"
		      "tests/failing/rubyspec/library/socket/fixtures"
		      "tests/failing/rubyspec/library/socket/tcpsocket"
		      "tests/failing/rubyspec/library/socket/tcpsocket/shared"
		      "tests/failing/rubyspec/library/socket/ipsocket"
		      "tests/failing/rubyspec/library/socket/constants"
		      "tests/failing/rubyspec/library/socket/unixserver"
		      "tests/failing/rubyspec/library/socket/unixserver/shared"
		      "tests/failing/rubyspec/library/socket/tcpserver"
		      "tests/failing/rubyspec/library/socket/shared"
		      "tests/failing/rubyspec/library/socket/basicsocket"
		      "tests/failing/rubyspec/library/socket/udpsocket"
		      "tests/failing/rubyspec/library/syslog"
		      "tests/failing/rubyspec/library/cgi"
		      "tests/failing/rubyspec/library/cgi/queryextension"
		      "tests/failing/rubyspec/library/cgi/queryextension/shared"
		      "tests/failing/rubyspec/library/cgi/queryextension/value"
		      "tests/failing/rubyspec/library/cgi/queryextension/value/shared"
		      "tests/failing/rubyspec/library/cgi/tagmaker"
		      "tests/failing/rubyspec/library/cgi/html4"
		      "tests/failing/rubyspec/library/cgi/htmlextension"
		      "tests/failing/rubyspec/library/cgi/htmlextension/fixtures"
		      "tests/failing/rubyspec/library/cgi/htmlextension/shared"
		      "tests/failing/rubyspec/library/cgi/html3"
		      "tests/failing/rubyspec/library/cgi/html4fr"
		      "tests/failing/rubyspec/library/cgi/cookie"
		      "tests/failing/rubyspec/library/cgi/html4tr"
		      "tests/failing/rubyspec/library/pathname"
		      "tests/failing/rubyspec/library/yaml"
		      "tests/failing/rubyspec/library/yaml/fixtures"
		      "tests/failing/rubyspec/library/yaml/shared"
		      "tests/failing/rubyspec/library/shellwords"
		      "tests/failing/rubyspec/library/logger"
		      "tests/failing/rubyspec/library/logger/device"
		      "tests/failing/rubyspec/library/logger/logger"
		      "tests/failing/rubyspec/library/logger/fixtures"
		      "tests/failing/rubyspec/library/logger/application"
		      "tests/failing/rubyspec/library/rexml"
		      "tests/failing/rubyspec/library/rexml/attributes"
		      "tests/failing/rubyspec/library/rexml/attributes/shared"
		      "tests/failing/rubyspec/library/rexml/node"
		      "tests/failing/rubyspec/library/rexml/element"
		      "tests/failing/rubyspec/library/rexml/attribute"
		      "tests/failing/rubyspec/library/rexml/text"
		      "tests/failing/rubyspec/library/rexml/document"
		      "tests/failing/rubyspec/library/rexml/shared"
		      "tests/failing/rubyspec/library/rexml/cdata"
		      "tests/failing/rubyspec/library/rexml/cdata/shared"
		      "tests/failing/rubyspec/library/resolv"
		      "tests/failing/rubyspec/library/zlib"
		      "tests/failing/rubyspec/library/zlib/zstream"
		      "tests/failing/rubyspec/library/zlib/gzipreader"
		      "tests/failing/rubyspec/library/zlib/inflate"
		      "tests/failing/rubyspec/library/zlib/gzipwriter"
		      "tests/failing/rubyspec/library/zlib/deflate"
		      "tests/failing/rubyspec/library/zlib/gzipfile"
		      "tests/failing/rubyspec/library/net"
		      "tests/failing/rubyspec/library/net/ftp"
		      "tests/failing/rubyspec/library/net/ftp/fixtures"
		      "tests/failing/rubyspec/library/net/ftp/shared"
		      "tests/failing/rubyspec/library/net/telnet"
		      "tests/failing/rubyspec/library/net/http"
		      "tests/failing/rubyspec/library/net/http/httprequest"
		      "tests/failing/rubyspec/library/net/http/http"
		      "tests/failing/rubyspec/library/net/http/http/fixtures"
		      "tests/failing/rubyspec/library/net/http/http/shared"
		      "tests/failing/rubyspec/library/net/http/httpheader"
		      "tests/failing/rubyspec/library/net/http/httpheader/fixtures"
		      "tests/failing/rubyspec/library/net/http/httpheader/shared"
		      "tests/failing/rubyspec/library/net/http/httpgenericrequest"
		      "tests/failing/rubyspec/library/net/http/httpresponse"
		      "tests/failing/rubyspec/library/net/http/httpresponse/shared"
		      "tests/failing/rubyspec/library/net/http/httpexceptions"
		      "tests/failing/rubyspec/library/net/http/httpexceptions/fixtures"
		      "tests/failing/rubyspec/library/openssl"
		      "tests/failing/rubyspec/library/openssl/shared"
		      "tests/failing/rubyspec/library/openssl/hmac"
		      "tests/failing/rubyspec/library/openssl/random"
		      "tests/failing/rubyspec/library/openssl/random/shared"
		      "tests/failing/rubyspec/library/ftools"
		      "tests/failing/rubyspec/library/scanf"
		      "tests/failing/rubyspec/library/scanf/string"
		      "tests/failing/rubyspec/library/scanf/string/shared"
		      "tests/failing/rubyspec/library/scanf/io"
		      "tests/failing/rubyspec/library/scanf/io/fixtures"
		      "tests/failing/rubyspec/library/scanf/io/shared"
		      "tests/failing/rubyspec/library/iconv"
		      "tests/failing/rubyspec/library/iconv/fixtures"
		      "tests/failing/rubyspec/library/iconv/shared"
		      "tests/failing/rubyspec/library/iconv/failure"
		      "tests/failing/rubyspec/library/tmpdir"
		      "tests/failing/rubyspec/library/tmpdir/dir"
		      "tests/failing/rubyspec/library/uri"
		      "tests/failing/rubyspec/library/uri/fixtures"
		      "tests/failing/rubyspec/library/uri/http"
		      "tests/failing/rubyspec/library/uri/mailto"
		      "tests/failing/rubyspec/library/abbrev"
		      "tests/failing/rubyspec/library/set"
		      "tests/failing/rubyspec/library/set/sortedset"
		      "tests/failing/rubyspec/library/set/sortedset/shared"
		      "tests/failing/rubyspec/library/set/shared"
		      "tests/failing/rubyspec/library/set/enumerable"
		      "tests/failing/rubyspec/library/complex"
		      "tests/failing/rubyspec/library/complex/numeric"
		      "tests/failing/rubyspec/library/complex/numeric/shared"
		      "tests/failing/rubyspec/library/complex/math"
		      "tests/failing/rubyspec/library/complex/math/fixtures"
		      "tests/failing/rubyspec/library/complex/math/shared"
		      "tests/failing/rubyspec/library/complex/shared"
		      "tests/failing/rubyspec/library/time"
		      "tests/failing/rubyspec/library/time/shared"
		      "tests/failing/rubyspec/library/ipaddr"
		      "tests/failing/rubyspec/library/observer"
		      "tests/failing/rubyspec/library/observer/fixtures"
		      "tests/failing/rubyspec/library/tempfile"
		      "tests/failing/rubyspec/library/tempfile/shared"
		      "tests/failing/rubyspec/library/getoptlong"
		      "tests/failing/rubyspec/library/getoptlong/shared"
		      "tests/failing/rubyspec/library/date"
		      "tests/failing/rubyspec/library/date/shared"
		      "tests/failing/rubyspec/library/generator"
		      "tests/failing/rubyspec/library/generator/fixtures"
		      "tests/failing/rubyspec/library/openstruct"
		      "tests/failing/rubyspec/library/openstruct/fixtures"
		      "tests/failing/rubyspec/library/openstruct/shared"
		      "tests/failing/rubyspec/library/securerandom"
		      "tests/failing/rubyspec/library/readline"
		      "tests/failing/rubyspec/library/readline/history"
		      "tests/failing/rubyspec/library/readline/history/shared"
		      "tests/failing/rubyspec/library/stringio"
		      "tests/failing/rubyspec/library/stringio/fixtures"
		      "tests/failing/rubyspec/library/stringio/shared"
		      "tests/failing/rubyspec/library/erb"
		      "tests/failing/rubyspec/library/erb/defmethod"
		      "tests/failing/rubyspec/library/erb/util"
		      "tests/failing/rubyspec/library/erb/util/shared"
		      "tests/failing/rubyspec/library/timeout"
		      "tests/failing/rubyspec/library/rational"
		      "tests/failing/rubyspec/library/base64"
		      "tests/failing/rubyspec/library/csv"
		      "tests/failing/rubyspec/library/csv/cell"
		      "tests/failing/rubyspec/library/csv/fixtures"
		      "tests/failing/rubyspec/library/csv/iobuf"
		      "tests/failing/rubyspec/library/csv/stringreader"
		      "tests/failing/rubyspec/library/csv/reader"
		      "tests/failing/rubyspec/library/csv/ioreader"
		      "tests/failing/rubyspec/library/csv/writer"
		      "tests/failing/rubyspec/library/csv/streambuf"
		      "tests/failing/rubyspec/library/csv/basicwriter"
		      "tests/failing/rubyspec/library/digest"
		      "tests/failing/rubyspec/library/digest/md5"
		      "tests/failing/rubyspec/library/digest/md5/shared"
		      "tests/failing/rubyspec/library/digest/sha512"
		      "tests/failing/rubyspec/library/digest/sha512/shared"
		      "tests/failing/rubyspec/library/digest/sha1"
		      "tests/failing/rubyspec/library/digest/sha1/shared"
		      "tests/failing/rubyspec/library/digest/sha384"
		      "tests/failing/rubyspec/library/digest/sha384/shared"
		      "tests/failing/rubyspec/library/digest/sha256"
		      "tests/failing/rubyspec/library/digest/sha256/shared"
		      "tests/failing/rubyspec/library/etc"
		      "tests/failing/rubyspec/library/matrix"
		      "tests/failing/rubyspec/library/matrix/vector"
		      "tests/failing/rubyspec/library/matrix/shared"
		      "tests/failing/rubyspec/library/matrix/scalar"
		      "tests/failing/rubyspec/library/bigdecimal"
		      "tests/failing/rubyspec/library/bigdecimal/fixtures"
		      "tests/failing/rubyspec/library/bigdecimal/shared"
		      "tests/failing/rubyspec/library/singleton"
		      "tests/failing/rubyspec/library/singleton/fixtures"
		      "tests/failing/rubyspec/library/enumerator"
		      "tests/failing/rubyspec/library/enumerator/fixtures"
		      "tests/failing/rubyspec/library/stringscanner"
		      "tests/failing/rubyspec/library/stringscanner/shared"
		      "tests/failing/rubyspec/library/drb"
		      "tests/failing/rubyspec/library/drb/fixtures"
		      "tests/failing/rubyspec/library/drb/drbobject"
		      "tests/failing/rubyspec/core"
		      "tests/failing/rubyspec/core/bignum"
		      "tests/failing/rubyspec/core/bignum/shared"
		      "tests/failing/rubyspec/core/binding"
		      "tests/failing/rubyspec/core/binding/fixtures"
		      "tests/failing/rubyspec/core/binding/shared"
		      "tests/failing/rubyspec/core/argf"
		      "tests/failing/rubyspec/core/argf/fixtures"
		      "tests/failing/rubyspec/core/argf/shared"
		      "tests/failing/rubyspec/core/string"
		      "tests/failing/rubyspec/core/string/fixtures"
		      "tests/failing/rubyspec/core/string/shared"
		      "tests/failing/rubyspec/core/regexp"
		      "tests/failing/rubyspec/core/regexp/shared"
		      "tests/failing/rubyspec/core/method"
		      "tests/failing/rubyspec/core/method/fixtures"
		      "tests/failing/rubyspec/core/method/shared"
		      "tests/failing/rubyspec/core/array"
		      "tests/failing/rubyspec/core/array/fixtures"
		      "tests/failing/rubyspec/core/array/shared"
		      "tests/failing/rubyspec/core/symbol"
		      "tests/failing/rubyspec/core/symbol/shared"
		      "tests/failing/rubyspec/core/signal"
		      "tests/failing/rubyspec/core/continuation"
		      "tests/failing/rubyspec/core/env"
		      "tests/failing/rubyspec/core/env/fixtures"
		      "tests/failing/rubyspec/core/env/shared"
		      "tests/failing/rubyspec/core/marshal"
		      "tests/failing/rubyspec/core/marshal/fixtures"
		      "tests/failing/rubyspec/core/float"
		      "tests/failing/rubyspec/core/float/shared"
		      "tests/failing/rubyspec/core/numeric"
		      "tests/failing/rubyspec/core/numeric/fixtures"
		      "tests/failing/rubyspec/core/process"
		      "tests/failing/rubyspec/core/false"
		      "tests/failing/rubyspec/core/module"
		      "tests/failing/rubyspec/core/module/fixtures"
		      "tests/failing/rubyspec/core/module/shared"
		      "tests/failing/rubyspec/core/proc"
		      "tests/failing/rubyspec/core/proc/fixtures"
		      "tests/failing/rubyspec/core/proc/shared"
		      "tests/failing/rubyspec/core/math"
		      "tests/failing/rubyspec/core/math/fixtures"
		      "tests/failing/rubyspec/core/time"
		      "tests/failing/rubyspec/core/time/fixtures"
		      "tests/failing/rubyspec/core/time/shared"
		      "tests/failing/rubyspec/core/filetest"
		      "tests/failing/rubyspec/core/hash"
		      "tests/failing/rubyspec/core/hash/fixtures"
		      "tests/failing/rubyspec/core/hash/shared"
		      "tests/failing/rubyspec/core/dir"
		      "tests/failing/rubyspec/core/dir/fixtures"
		      "tests/failing/rubyspec/core/dir/shared"
		      "tests/failing/rubyspec/core/unboundmethod"
		      "tests/failing/rubyspec/core/unboundmethod/fixtures"
		      "tests/failing/rubyspec/core/unboundmethod/shared"
		      "tests/failing/rubyspec/core/file"
		      "tests/failing/rubyspec/core/file/stat"
		      "tests/failing/rubyspec/core/file/stat/fixtures"
		      "tests/failing/rubyspec/core/file/fixtures"
		      "tests/failing/rubyspec/core/file/constants"
		      "tests/failing/rubyspec/core/file/shared"
		      "tests/failing/rubyspec/core/object"
		      "tests/failing/rubyspec/core/object/shared"
		      "tests/failing/rubyspec/core/thread"
		      "tests/failing/rubyspec/core/thread/fixtures"
		      "tests/failing/rubyspec/core/thread/shared"
		      "tests/failing/rubyspec/core/integer"
		      "tests/failing/rubyspec/core/integer/shared"
		      "tests/failing/rubyspec/core/io"
		      "tests/failing/rubyspec/core/io/fixtures"
		      "tests/failing/rubyspec/core/io/shared"
		      "tests/failing/rubyspec/core/nil"
		      "tests/failing/rubyspec/core/enumerable"
		      "tests/failing/rubyspec/core/enumerable/fixtures"
		      "tests/failing/rubyspec/core/enumerable/shared"
		      "tests/failing/rubyspec/core/fixnum"
		      "tests/failing/rubyspec/core/fixnum/shared"
		      "tests/failing/rubyspec/core/precision"
		      "tests/failing/rubyspec/core/struct"
		      "tests/failing/rubyspec/core/struct/fixtures"
		      "tests/failing/rubyspec/core/struct/shared"
		      "tests/failing/rubyspec/core/true"
		      "tests/failing/rubyspec/core/matchdata"
		      "tests/failing/rubyspec/core/matchdata/shared"
		      "tests/failing/rubyspec/core/threadgroup"
		      "tests/failing/rubyspec/core/threadgroup/fixtures"
		      "tests/failing/rubyspec/core/comparable"
		      "tests/failing/rubyspec/core/comparable/fixtures"
		      "tests/failing/rubyspec/core/objectspace"
		      "tests/failing/rubyspec/core/gc"
		      "tests/failing/rubyspec/core/class"
		      "tests/failing/rubyspec/core/class/fixtures"
		      "tests/failing/rubyspec/core/exception"
		      "tests/failing/rubyspec/core/exception/fixtures"
		      "tests/failing/rubyspec/core/exception/shared"
		      "tests/failing/rubyspec/core/kernel"
		      "tests/failing/rubyspec/core/kernel/fixtures"
		      "tests/failing/rubyspec/core/kernel/shared"
		      "tests/failing/rubyspec/core/range"
		      "tests/failing/rubyspec/core/range/shared"
		      "tests/failing/rubyspec/shared"
		      "tests/failing/rubyspec/shared/file"
		      ))

(define passed-dirs '("tests/passing/mine"
		      "tests/passing/jruby"
		      "tests/passing/ruby"
		      "tests/passing/ruby/heredoc"
		      "tests/passing/rubyspec/core/array"
		      "tests/passing/rubyspec/fixtures"
		      "tests/passing/rubyspec/fixtures/require"
		      "tests/passing/rubyspec/fixtures/load"
		      "tests/passing/rubyspec/language"
		      "tests/passing/rubyspec/language/fixtures"
		      "tests/passing/rubyspec/library"
		      "tests/passing/rubyspec/library/mathn"
		      "tests/passing/rubyspec/library/mathn/math"
		      "tests/passing/rubyspec/library/mathn/math/fixtures"
		      "tests/passing/rubyspec/library/mathn/math/shared"
		      "tests/passing/rubyspec/library/mathn/rational"
		      "tests/passing/rubyspec/library/mathn/integer"
		      "tests/passing/rubyspec/library/mathn/prime"
		      "tests/passing/rubyspec/library/socket"
		      "tests/passing/rubyspec/library/socket/socket"
		      "tests/passing/rubyspec/library/socket/unixsocket"
		      "tests/passing/rubyspec/library/socket/unixsocket/shared"
		      "tests/passing/rubyspec/library/socket/fixtures"
		      "tests/passing/rubyspec/library/socket/tcpsocket"
		      "tests/passing/rubyspec/library/socket/tcpsocket/shared"
		      "tests/passing/rubyspec/library/socket/ipsocket"
		      "tests/passing/rubyspec/library/socket/constants"
		      "tests/passing/rubyspec/library/socket/unixserver"
		      "tests/passing/rubyspec/library/socket/unixserver/shared"
		      "tests/passing/rubyspec/library/socket/tcpserver"
		      "tests/passing/rubyspec/library/socket/shared"
		      "tests/passing/rubyspec/library/socket/basicsocket"
		      "tests/passing/rubyspec/library/socket/udpsocket"
		      "tests/passing/rubyspec/library/syslog"
		      "tests/passing/rubyspec/library/cgi"
		      "tests/passing/rubyspec/library/cgi/queryextension"
		      "tests/passing/rubyspec/library/cgi/queryextension/shared"
		      "tests/passing/rubyspec/library/cgi/queryextension/value"
		      "tests/passing/rubyspec/library/cgi/queryextension/value/shared"
		      "tests/passing/rubyspec/library/cgi/tagmaker"
		      "tests/passing/rubyspec/library/cgi/html4"
		      "tests/passing/rubyspec/library/cgi/htmlextension"
		      "tests/passing/rubyspec/library/cgi/htmlextension/fixtures"
		      "tests/passing/rubyspec/library/cgi/htmlextension/shared"
		      "tests/passing/rubyspec/library/cgi/html3"
		      "tests/passing/rubyspec/library/cgi/html4fr"
		      "tests/passing/rubyspec/library/cgi/cookie"
		      "tests/passing/rubyspec/library/cgi/html4tr"
		      "tests/passing/rubyspec/library/pathname"
		      "tests/passing/rubyspec/library/yaml"
		      "tests/passing/rubyspec/library/yaml/fixtures"
		      "tests/passing/rubyspec/library/yaml/shared"
		      "tests/passing/rubyspec/library/shellwords"
		      "tests/passing/rubyspec/library/logger"
		      "tests/passing/rubyspec/library/logger/device"
		      "tests/passing/rubyspec/library/logger/logger"
		      "tests/passing/rubyspec/library/logger/fixtures"
		      "tests/passing/rubyspec/library/logger/application"
		      "tests/passing/rubyspec/library/rexml"
		      "tests/passing/rubyspec/library/rexml/attributes"
		      "tests/passing/rubyspec/library/rexml/attributes/shared"
		      "tests/passing/rubyspec/library/rexml/node"
		      "tests/passing/rubyspec/library/rexml/element"
		      "tests/passing/rubyspec/library/rexml/attribute"
		      "tests/passing/rubyspec/library/rexml/text"
		      "tests/passing/rubyspec/library/rexml/document"
		      "tests/passing/rubyspec/library/rexml/shared"
		      "tests/passing/rubyspec/library/rexml/cdata"
		      "tests/passing/rubyspec/library/rexml/cdata/shared"
		      "tests/passing/rubyspec/library/resolv"
		      "tests/passing/rubyspec/library/zlib"
		      "tests/passing/rubyspec/library/zlib/zstream"
		      "tests/passing/rubyspec/library/zlib/gzipreader"
		      "tests/passing/rubyspec/library/zlib/inflate"
		      "tests/passing/rubyspec/library/zlib/gzipwriter"
		      "tests/passing/rubyspec/library/zlib/deflate"
		      "tests/passing/rubyspec/library/zlib/gzipfile"
		      "tests/passing/rubyspec/library/net"
		      "tests/passing/rubyspec/library/net/ftp"
		      "tests/passing/rubyspec/library/net/ftp/fixtures"
		      "tests/passing/rubyspec/library/net/ftp/shared"
		      "tests/passing/rubyspec/library/net/telnet"
		      "tests/passing/rubyspec/library/net/http"
		      "tests/passing/rubyspec/library/net/http/httprequest"
		      "tests/passing/rubyspec/library/net/http/http"
		      "tests/passing/rubyspec/library/net/http/http/fixtures"
		      "tests/passing/rubyspec/library/net/http/http/shared"
		      "tests/passing/rubyspec/library/net/http/httpheader"
		      "tests/passing/rubyspec/library/net/http/httpheader/fixtures"
		      "tests/passing/rubyspec/library/net/http/httpheader/shared"
		      "tests/passing/rubyspec/library/net/http/httpgenericrequest"
		      "tests/passing/rubyspec/library/net/http/httpresponse"
		      "tests/passing/rubyspec/library/net/http/httpresponse/shared"
		      "tests/passing/rubyspec/library/net/http/httpexceptions"
		      "tests/passing/rubyspec/library/net/http/httpexceptions/fixtures"
		      "tests/passing/rubyspec/library/openssl"
		      "tests/passing/rubyspec/library/openssl/shared"
		      "tests/passing/rubyspec/library/openssl/hmac"
		      "tests/passing/rubyspec/library/openssl/random"
		      "tests/passing/rubyspec/library/openssl/random/shared"
		      "tests/passing/rubyspec/library/ftools"
		      "tests/passing/rubyspec/library/scanf"
		      "tests/passing/rubyspec/library/scanf/string"
		      "tests/passing/rubyspec/library/scanf/string/shared"
		      "tests/passing/rubyspec/library/scanf/io"
		      "tests/passing/rubyspec/library/scanf/io/fixtures"
		      "tests/passing/rubyspec/library/scanf/io/shared"
		      "tests/passing/rubyspec/library/iconv"
		      "tests/passing/rubyspec/library/iconv/fixtures"
		      "tests/passing/rubyspec/library/iconv/shared"
		      "tests/passing/rubyspec/library/iconv/failure"
		      "tests/passing/rubyspec/library/tmpdir"
		      "tests/passing/rubyspec/library/tmpdir/dir"
		      "tests/passing/rubyspec/library/uri"
		      "tests/passing/rubyspec/library/uri/fixtures"
		      "tests/passing/rubyspec/library/uri/http"
		      "tests/passing/rubyspec/library/uri/mailto"
		      "tests/passing/rubyspec/library/abbrev"
		      "tests/passing/rubyspec/library/set"
		      "tests/passing/rubyspec/library/set/sortedset"
		      "tests/passing/rubyspec/library/set/sortedset/shared"
		      "tests/passing/rubyspec/library/set/shared"
		      "tests/passing/rubyspec/library/set/enumerable"
		      "tests/passing/rubyspec/library/complex"
		      "tests/passing/rubyspec/library/complex/numeric"
		      "tests/passing/rubyspec/library/complex/numeric/shared"
		      "tests/passing/rubyspec/library/complex/math"
		      "tests/passing/rubyspec/library/complex/math/fixtures"
		      "tests/passing/rubyspec/library/complex/math/shared"
		      "tests/passing/rubyspec/library/complex/shared"
		      "tests/passing/rubyspec/library/time"
		      "tests/passing/rubyspec/library/time/shared"
		      "tests/passing/rubyspec/library/ipaddr"
		      "tests/passing/rubyspec/library/observer"
		      "tests/passing/rubyspec/library/observer/fixtures"
		      "tests/passing/rubyspec/library/tempfile"
		      "tests/passing/rubyspec/library/tempfile/shared"
		      "tests/passing/rubyspec/library/getoptlong"
		      "tests/passing/rubyspec/library/getoptlong/shared"
		      "tests/passing/rubyspec/library/date"
		      "tests/passing/rubyspec/library/date/shared"
		      "tests/passing/rubyspec/library/generator"
		      "tests/passing/rubyspec/library/generator/fixtures"
		      "tests/passing/rubyspec/library/openstruct"
		      "tests/passing/rubyspec/library/openstruct/fixtures"
		      "tests/passing/rubyspec/library/openstruct/shared"
		      "tests/passing/rubyspec/library/securerandom"
		      "tests/passing/rubyspec/library/readline"
		      "tests/passing/rubyspec/library/readline/history"
		      "tests/passing/rubyspec/library/readline/history/shared"
		      "tests/passing/rubyspec/library/stringio"
		      "tests/passing/rubyspec/library/stringio/fixtures"
		      "tests/passing/rubyspec/library/stringio/shared"
		      "tests/passing/rubyspec/library/erb"
		      "tests/passing/rubyspec/library/erb/defmethod"
		      "tests/passing/rubyspec/library/erb/util"
		      "tests/passing/rubyspec/library/erb/util/shared"
		      "tests/passing/rubyspec/library/timeout"
		      "tests/passing/rubyspec/library/rational"
		      "tests/passing/rubyspec/library/base64"
		      "tests/passing/rubyspec/library/csv"
		      "tests/passing/rubyspec/library/csv/cell"
		      "tests/passing/rubyspec/library/csv/fixtures"
		      "tests/passing/rubyspec/library/csv/iobuf"
		      "tests/passing/rubyspec/library/csv/stringreader"
		      "tests/passing/rubyspec/library/csv/reader"
		      "tests/passing/rubyspec/library/csv/ioreader"
		      "tests/passing/rubyspec/library/csv/writer"
		      "tests/passing/rubyspec/library/csv/streambuf"
		      "tests/passing/rubyspec/library/csv/basicwriter"
		      "tests/passing/rubyspec/library/digest"
		      "tests/passing/rubyspec/library/digest/md5"
		      "tests/passing/rubyspec/library/digest/md5/shared"
		      "tests/passing/rubyspec/library/digest/sha512"
		      "tests/passing/rubyspec/library/digest/sha512/shared"
		      "tests/passing/rubyspec/library/digest/sha1"
		      "tests/passing/rubyspec/library/digest/sha1/shared"
		      "tests/passing/rubyspec/library/digest/sha384"
		      "tests/passing/rubyspec/library/digest/sha384/shared"
		      "tests/passing/rubyspec/library/digest/sha256"
		      "tests/passing/rubyspec/library/digest/sha256/shared"
		      "tests/passing/rubyspec/library/etc"
		      "tests/passing/rubyspec/library/matrix"
		      "tests/passing/rubyspec/library/matrix/vector"
		      "tests/passing/rubyspec/library/matrix/shared"
		      "tests/passing/rubyspec/library/matrix/scalar"
		      "tests/passing/rubyspec/library/bigdecimal"
		      "tests/passing/rubyspec/library/bigdecimal/fixtures"
		      "tests/passing/rubyspec/library/bigdecimal/shared"
		      "tests/passing/rubyspec/library/singleton"
		      "tests/passing/rubyspec/library/singleton/fixtures"
		      "tests/passing/rubyspec/library/enumerator"
		      "tests/passing/rubyspec/library/enumerator/fixtures"
		      "tests/passing/rubyspec/library/stringscanner"
		      "tests/passing/rubyspec/library/stringscanner/shared"
		      "tests/passing/rubyspec/library/drb"
		      "tests/passing/rubyspec/library/drb/fixtures"
		      "tests/passing/rubyspec/library/drb/drbobject"
		      "tests/passing/rubyspec/core"
		      "tests/passing/rubyspec/core/bignum"
		      "tests/passing/rubyspec/core/bignum/shared"
		      "tests/passing/rubyspec/core/binding"
		      "tests/passing/rubyspec/core/binding/fixtures"
		      "tests/passing/rubyspec/core/binding/shared"
		      "tests/passing/rubyspec/core/argf"
		      "tests/passing/rubyspec/core/argf/fixtures"
		      "tests/passing/rubyspec/core/argf/shared"
		      "tests/passing/rubyspec/core/string"
		      "tests/passing/rubyspec/core/string/fixtures"
		      "tests/passing/rubyspec/core/string/shared"
		      "tests/passing/rubyspec/core/regexp"
		      "tests/passing/rubyspec/core/regexp/shared"
		      "tests/passing/rubyspec/core/method"
		      "tests/passing/rubyspec/core/method/fixtures"
		      "tests/passing/rubyspec/core/method/shared"
		      "tests/passing/rubyspec/core/array"
		      "tests/passing/rubyspec/core/array/fixtures"
		      "tests/passing/rubyspec/core/array/shared"
		      "tests/passing/rubyspec/core/symbol"
		      "tests/passing/rubyspec/core/symbol/shared"
		      "tests/passing/rubyspec/core/signal"
		      "tests/passing/rubyspec/core/continuation"
		      "tests/passing/rubyspec/core/env"
		      "tests/passing/rubyspec/core/env/fixtures"
		      "tests/passing/rubyspec/core/env/shared"
		      "tests/passing/rubyspec/core/marshal"
		      "tests/passing/rubyspec/core/marshal/fixtures"
		      "tests/passing/rubyspec/core/float"
		      "tests/passing/rubyspec/core/float/shared"
		      "tests/passing/rubyspec/core/numeric"
		      "tests/passing/rubyspec/core/numeric/fixtures"
		      "tests/passing/rubyspec/core/process"
		      "tests/passing/rubyspec/core/false"
		      "tests/passing/rubyspec/core/module"
		      "tests/passing/rubyspec/core/module/fixtures"
		      "tests/passing/rubyspec/core/module/shared"
		      "tests/passing/rubyspec/core/proc"
		      "tests/passing/rubyspec/core/proc/fixtures"
		      "tests/passing/rubyspec/core/proc/shared"
		      "tests/passing/rubyspec/core/math"
		      "tests/passing/rubyspec/core/math/fixtures"
		      "tests/passing/rubyspec/core/time"
		      "tests/passing/rubyspec/core/time/fixtures"
		      "tests/passing/rubyspec/core/time/shared"
		      "tests/passing/rubyspec/core/filetest"
		      "tests/passing/rubyspec/core/hash"
		      "tests/passing/rubyspec/core/hash/fixtures"
		      "tests/passing/rubyspec/core/hash/shared"
		      "tests/passing/rubyspec/core/dir"
		      "tests/passing/rubyspec/core/dir/fixtures"
		      "tests/passing/rubyspec/core/dir/shared"
		      "tests/passing/rubyspec/core/unboundmethod"
		      "tests/passing/rubyspec/core/unboundmethod/fixtures"
		      "tests/passing/rubyspec/core/unboundmethod/shared"
		      "tests/passing/rubyspec/core/file"
		      "tests/passing/rubyspec/core/file/stat"
		      "tests/passing/rubyspec/core/file/stat/fixtures"
		      "tests/passing/rubyspec/core/file/fixtures"
		      "tests/passing/rubyspec/core/file/constants"
		      "tests/passing/rubyspec/core/file/shared"
		      "tests/passing/rubyspec/core/object"
		      "tests/passing/rubyspec/core/object/shared"
		      "tests/passing/rubyspec/core/thread"
		      "tests/passing/rubyspec/core/thread/fixtures"
		      "tests/passing/rubyspec/core/thread/shared"
		      "tests/passing/rubyspec/core/integer"
		      "tests/passing/rubyspec/core/integer/shared"
		      "tests/passing/rubyspec/core/io"
		      "tests/passing/rubyspec/core/io/fixtures"
		      "tests/passing/rubyspec/core/io/shared"
		      "tests/passing/rubyspec/core/nil"
		      "tests/passing/rubyspec/core/enumerable"
		      "tests/passing/rubyspec/core/enumerable/fixtures"
		      "tests/passing/rubyspec/core/enumerable/shared"
		      "tests/passing/rubyspec/core/fixnum"
		      "tests/passing/rubyspec/core/fixnum/shared"
		      "tests/passing/rubyspec/core/precision"
		      "tests/passing/rubyspec/core/struct"
		      "tests/passing/rubyspec/core/struct/fixtures"
		      "tests/passing/rubyspec/core/struct/shared"
		      "tests/passing/rubyspec/core/true"
		      "tests/passing/rubyspec/core/matchdata"
		      "tests/passing/rubyspec/core/matchdata/shared"
		      "tests/passing/rubyspec/core/threadgroup"
		      "tests/passing/rubyspec/core/threadgroup/fixtures"
		      "tests/passing/rubyspec/core/comparable"
		      "tests/passing/rubyspec/core/comparable/fixtures"
		      "tests/passing/rubyspec/core/objectspace"
		      "tests/passing/rubyspec/core/gc"
		      "tests/passing/rubyspec/core/class"
		      "tests/passing/rubyspec/core/class/fixtures"
		      "tests/passing/rubyspec/core/exception"
		      "tests/passing/rubyspec/core/exception/fixtures"
		      "tests/passing/rubyspec/core/exception/shared"
		      "tests/passing/rubyspec/core/kernel"
		      "tests/passing/rubyspec/core/kernel/fixtures"
		      "tests/passing/rubyspec/core/kernel/shared"
		      "tests/passing/rubyspec/core/range"
		      "tests/passing/rubyspec/core/range/shared"
		      "tests/passing/rubyspec/shared"
		      "tests/passing/rubyspec/shared/file"
		      ))

(define (doit file passed?)
  ;; (printf "File ~a\n" file)
  (if (passed? (parse file))
    (begin
      ;; (printf "~a ok\n" file)
      1)
    (begin
      (printf "~a failed!\n" file)
      0)))

;;  (printf "~a\n" (pretty-print (parse (string->path file)))))

(define (ruby-files dir)
  (with-handlers ((exn:fail? (lambda (e) '())))
    (let ((all (directory-list dir)))
      (map (lambda (name)
	     (build-path dir name))
	   (filter (lambda (name) (string-suffix? ".rb" (path->string name)))
		   all)))))

(define (all-in-dir dir passed?)
  (let ((files (ruby-files dir)))
    (values (apply + 0 (map (lambda (f)
			      (doit f passed?))
			    files))
	    (length files))))

(define (check dirs passed?)
  (let loop ((passed 0)
	     (total 0)
	     (dirs dirs))
    (if (null? dirs)
      (begin
	(printf "~a passed out of ~a\n" passed total)
	(values passed total))
      (let-values (((score number) (all-in-dir (car dirs) passed?)))
	(loop (+ passed score) (+ total number) (cdr dirs))))))

(printf "Checking passing tests\n")
(define-values (passed t1)
		 (check passed-dirs (lambda (n) n)))
(printf "Checking failing tests\n")
(define-values (failed t2)
	       (check failed-dirs (lambda (n) (not n))))
(printf "\nPassing ~a%\n" (* 100 (+ 0.0 (/ passed (+ t1 t2)))))

(dump-statistics)
